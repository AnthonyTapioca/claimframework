<input id="code" type="text" placeholder="Enter your claim code" class="w-full mb-4 p-4 border rounded-xl" />

<button onclick="redeemCode()" class="w-full py-4 rounded-xl bg-green-600 text-white font-bold mb-4">
  Get Product
</button>

<div id="result"></div>

<script>
async function redeemCode() {
  const code = document.getElementById('code').value.trim();
  if (!code) { alert('Enter your claim code'); return; }

  try {
    const res = await fetch('/api', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'redeem', code })
    });

    let data;
    try { data = await res.json(); }
    catch { const text = await res.text(); alert("Non-JSON response: " + text); return; }

    if (!res.ok) throw new Error(data.error || 'Failed');

    document.getElementById('result').innerHTML = `
      Product: <strong>${data.product || 'N/A'}</strong><br/>
      Order ID: <strong>${data.orderId}</strong><br/>
      ${data.alreadyRedeemed ? '<span style="color:red">Already redeemed</span>' : ''}
    `;
  } catch (err) {
    alert(err.message || 'Error redeeming code');
  }
}
</script>
