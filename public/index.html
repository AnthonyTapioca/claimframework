<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shoplox Claim</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 via-white to-orange-50 flex items-center justify-center px-6">
<main class="w-full max-w-xl bg-white p-10 rounded-3xl shadow-lg">
  <h1 class="text-4xl font-bold text-center mb-6">
    SHOP<span class="text-purple-600">LOX</span>
  </h1>

  <input id="orderId" type="text" placeholder="Enter your Order ID" class="w-full mb-4 p-4 border rounded-xl" />

  <button onclick="redeemOrder()" class="w-full py-4 rounded-xl bg-green-600 text-white font-bold mb-4">
    Get Claim Code
  </button>

  <div id="result" class="text-center text-lg font-semibold text-gray-700"></div>
</main>

<script>
async function redeemOrder() {
  const orderId = document.getElementById('orderId').value.trim();
  if (!orderId) { alert('Please enter your Order ID.'); return; }

  try {
    const res = await fetch('/api', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'redeem', orderId })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Failed to redeem');

    document.getElementById('result').innerHTML = `
      Claim Code: <span class="text-green-600 font-bold">${data.code}</span><br/>
      Product: ${data.product || 'N/A'}<br/>
      ${data.alreadyRedeemed ? '<span class="text-red-600">Already redeemed</span>' : ''}
    `;
  } catch (err) {
    alert(err.message || 'Error fetching claim code');
  }
}
</script>
</body>
</html>
